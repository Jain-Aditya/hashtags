{% extends "hashtags/base.html" %}
{% load static %}
{% load url_replace %}

{% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<div class="container">
    <form id="tag-search">
        <div class="row">
            <div class="four columns">
                {{ form.query }}
            </div>
            <div class="four columns">
                {{ form.project }}
            </div>
            <div class="two columns">
                <input class="u-full-width button-primary" type="submit" value="Submit">
            </div>
        </div>
        <div class="row">
            <div class="three columns" style="margin-right: 2em">
                {{ form.startdate.label }}
                {{ form.startdate }}
            </div>
            <div class="three columns">
                {{ form.enddate.label }}
                {{ form.enddate }}
            </div>
        </div>
        <div class="row">
            <button type="button" onclick="showAdvance()">More Filters</button>
        </div>
        <div class="row" id="adv" style="display: none">
            <div style="margin-right: 2em">
                {{ form.search_type.label }}
                {{ form.search_type }}
                &nbsp;
                <div class="tooltip">&nbsp; ?
                    <span class="tooltiptext">When searching for multiple hashtags, should the results be a subset or union?</span>
                </div>
            </div>
            <div style="margin-right: 2em">
                {{ form.user.label }}
                {{ form.user }}
            </div>
        </div>
    </form>
    {% if not hashtags %}
    <h3>No data found.</h3>

    {% else %}
    <div class="info">
        <div class="row">
            <div class="two-thirds column">
                <h2>
                    {% for query in hashtag_query_list %}
                    #{{ query }}
                    {% endfor %}
                </h2>
                <h2>Statistics</h2>
                <a href="/?{{ query_string }}"><button>Show list</button></a>
            </div>
            <div class="one-third column">
                {% include "hashtags/stats_table.html" %}
            </div>
        </div>
    </div>
    <div id="top_projects">
        <hr>
        <div class="row"><h1>Top projects</h1></div>
        <div class="row">
            <div class="two-thirds column">
                <div align="center" id="loader1">
                    <img type="image/gif" src="{% static 'loader.gif' %}">
                </div>
                <canvas id="projectsChart" width="400" height="400"></canvas>
            </div>
            <div class="one-third column">
                <a href="/projects_csv/?{{ query_string }}"><button>Download CSV</button></a>
                <a href="/all_projects/?{{ query_string }}"><button>View Full Stats</button></a>
            </div>
        </div>
    </div>
    <div id="top_users">
        <hr>
        <div class="row"><h1>Top users</h1></div>
        <div class="row">
            <div class="two-thirds column">
                <div align="center" id="loader2">
                    <img type="image/gif" src="{% static 'loader.gif' %}">
                </div>
                <canvas id="usersChart" width="400" height="400"></canvas>
            </div>
            <div class="one-third column">
                <a href="/users_csv/?{{ query_string }}"><button>Download CSV</button></a>
                <a href="/all_users/?{{ query_string }}"><button>View Full Stats</button></a>    
            </div>
        </div>
    </div>
    <hr>
    <div class="row"><h1>Edits over time</h1></div>
    <div class="row">
        <div align="center" id="loader3">
            <img type="image/gif" src="{% static 'loader.gif' %}">
        </div>
        <div>
            <canvas id="timeChart" width="400" height="400"></canvas>
        </div>
        <div class="row">
            <a href="/time_csv/?{{ query_string }}"><button>Download CSV</button></a>
        </div>
    </div>
    <hr>
    <script> var url_param = '{{ query_string }}'; </script>
    <script src="{% static 'js/graph.js' %}"></script>
    {% endif %}
</div>
{% endblock content %}